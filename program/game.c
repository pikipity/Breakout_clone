#include <reg52.h>
#include "game.h"
#include "lcd12864.h"

//variables of game
unsigned char game_status=4;//2: win  1: continue. 0: end  3: firest time show life 4: show title  5: waiting for start  6:show level
							//7: enter eat longer 8: eat clear 9: eat win  10:eat die
							//11: quit eat longer
unsigned char life=5;
unsigned char number_frame=0;
unsigned char max_number_frame=0;
bit frame_finish=0;
bit frame_begin=0;
unsigned char level=1;//total 3 level

//win character
unsigned char code win[]={
	0x04,0xFC,0xFC,0x04,0x00,0x00,0x00,0x00,  // -W-
	0x04,0xFC,0xFC,0x04,0x00,0x03,0xFF,0x80,
	0x00,0xFC,0xFC,0x00,0x80,0xFF,0x03,0x00,
	0x00,0x00,0x03,0x3F,0x3C,0x03,0x03,0x3C,
	0x3F,0x03,0x00,0x00,
	0x00,0x00,0x00,0x04,0x04,0x04,0xFC,0xFC,  // -I-
	0x04,0x04,0x04,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x20,0x20,0x20,0x3F,0x3F,
	0x20,0x20,0x20,0x00,
	0x04,0xFC,0xFC,0xE0,0x00,0x00,0x00,0x04,  // -N-
	0xFC,0xFC,0x04,0x00,0x00,0xFF,0xFF,0x01,
	0x07,0x1C,0x70,0xC0,0xFF,0xFF,0x00,0x00,
	0x20,0x3F,0x3F,0x20,0x00,0x00,0x00,0x03,
	0x0F,0x3F,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0xFC,0xFE,0xFC,  // -!-
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x03,0xFF,0x03,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x30,0x79,0x30,
	0x00,0x00,0x00,0x00};
unsigned char code die[]={
	0x04,0xFC,0xFC,0x04,0x04,0x04,0x0C,0x18,  // -D-
	0x70,0xE0,0x80,0x00,0x00,0xFF,0xFF,0x00,
	0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0x20,0x3F,0x3F,0x20,0x20,0x20,0x30,0x18,
	0x0E,0x07,0x01,0x00,
	0x00,0x00,0x00,0x04,0x04,0x04,0xFC,0xFC,  // -I-
	0x04,0x04,0x04,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x20,0x20,0x20,0x3F,0x3F,
	0x20,0x20,0x20,0x00,
	0x04,0xFC,0xFC,0x04,0x04,0x04,0x04,0x04,  // -E-
	0x0C,0x1C,0x7C,0x00,0x00,0xFF,0xFF,0x08,
	0x08,0x08,0x1C,0x7F,0x00,0x00,0x00,0x00,
	0x20,0x3F,0x3F,0x20,0x20,0x20,0x20,0x20,
	0x30,0x38,0x3E,0x00,
	0x00,0x00,0x00,0x00,0x00,0xFC,0xFE,0xFC,  // -!-
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x03,0xFF,0x03,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x30,0x79,0x30,
	0x00,0x00,0x00,0x00};
unsigned char code lifefont[]={
	0x04,0xFC,0xFC,0x04,0x00,0x00,0x00,0x00,  // -L-
	0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x20,0x3F,0x3F,0x20,0x20,0x20,0x20,0x20,
	0x30,0x38,0x3E,0x00,
	0x00,0x00,0x00,0x04,0x04,0x04,0xFC,0xFC,  // -I-
	0x04,0x04,0x04,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x20,0x20,0x20,0x3F,0x3F,
	0x20,0x20,0x20,0x00,
	0x04,0xFC,0xFC,0x04,0x04,0x04,0x04,0x04,  // -F-
	0x0C,0x1C,0x7C,0x00,0x00,0xFF,0xFF,0x08,
	0x08,0x08,0x1C,0x7F,0x00,0x00,0x00,0x00,
	0x20,0x3F,0x3F,0x20,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,
	0x04,0xFC,0xFC,0x04,0x04,0x04,0x04,0x04,  // -E-
	0x0C,0x1C,0x7C,0x00,0x00,0xFF,0xFF,0x08,
	0x08,0x08,0x1C,0x7F,0x00,0x00,0x00,0x00,
	0x20,0x3F,0x3F,0x20,0x20,0x20,0x20,0x20,
	0x30,0x38,0x3E,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,  // -=-
	0x00,0x00,0x00,0x00,0x00,0xC3,0xC3,0xC3,
	0xC3,0xC3,0xC3,0xC3,0xC3,0xC3,0xC3,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00};
unsigned char code levelfont[]={
	//level=
	0x04,0xFC,0xFC,0x04,0x00,0x00,0x00,0x00,  // -L-
	0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x20,0x3F,0x3F,0x20,0x20,0x20,0x20,0x20,
	0x30,0x38,0x3E,0x00,
	0x04,0xFC,0xFC,0x04,0x04,0x04,0x04,0x04,  // -E-
	0x0C,0x1C,0x7C,0x00,0x00,0xFF,0xFF,0x08,
	0x08,0x08,0x1C,0x7F,0x00,0x00,0x00,0x00,
	0x20,0x3F,0x3F,0x20,0x20,0x20,0x20,0x20,
	0x30,0x38,0x3E,0x00,
	0x04,0xFC,0xFC,0x04,0x00,0x00,0x00,0x04,  // -V-
	0xFC,0xFC,0x04,0x00,0x00,0x00,0x3F,0xFF,
	0xC0,0x00,0xC0,0xFF,0x3F,0x00,0x00,0x00,
	0x00,0x00,0x00,0x03,0x1F,0x3C,0x1F,0x03,
	0x00,0x00,0x00,0x00,
	0x04,0xFC,0xFC,0x04,0x04,0x04,0x04,0x04,  // -E-
	0x0C,0x1C,0x7C,0x00,0x00,0xFF,0xFF,0x08,
	0x08,0x08,0x1C,0x7F,0x00,0x00,0x00,0x00,
	0x20,0x3F,0x3F,0x20,0x20,0x20,0x20,0x20,
	0x30,0x38,0x3E,0x00,
	0x04,0xFC,0xFC,0x04,0x00,0x00,0x00,0x00,  // -L-
	0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x20,0x3F,0x3F,0x20,0x20,0x20,0x20,0x20,
	0x30,0x38,0x3E,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,  // -=-
	0x00,0x00,0x00,0x00,0x00,0xC3,0xC3,0xC3,
	0xC3,0xC3,0xC3,0xC3,0xC3,0xC3,0xC3,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00};
unsigned char code number[]={
	0x00,0xC0,0xF0,0x38,0x0C,0x04,0x0C,0x38,  // -0-
	0xF0,0xC0,0x00,0x00,0xFF,0xFF,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0x00,0x03,0x0F,0x1C,0x30,0x20,0x30,0x1C,
	0x0F,0x03,0x00,0x00,
	0x00,0x10,0x10,0x18,0x18,0xFC,0xFC,0x00,  // -1-
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x20,0x20,0x20,0x3F,0x3F,0x20,
	0x20,0x20,0x00,0x00,
	0x60,0xF0,0xF8,0x0C,0x04,0x04,0x04,0x0C,  // -2-
	0x18,0xF0,0xE0,0x00,0x00,0x00,0x00,0x80,
	0xC0,0x60,0x30,0x18,0x0E,0x07,0x01,0x00,
	0x38,0x3E,0x3F,0x33,0x30,0x30,0x30,0x30,
	0x30,0x30,0x3C,0x00,
	0x00,0x30,0x78,0x78,0x0C,0x04,0x04,0x0C,  // -3-
	0x18,0xF8,0xF0,0x00,0x00,0x00,0x00,0x00,
	0x08,0x08,0x1C,0x16,0x33,0xE1,0xC0,0x00,
	0x0C,0x1E,0x3E,0x30,0x20,0x20,0x20,0x30,
	0x18,0x1F,0x0F,0x00,
	0x00,0x00,0x00,0x00,0x80,0xE0,0x38,0xFC,  // -4-
	0xFC,0x00,0x00,0x00,0x80,0xE0,0x38,0x0E,
	0x03,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,
	0x01,0x01,0x01,0x01,0x01,0x21,0x21,0x3F,
	0x3F,0x21,0x21,0x01,
	0x00,0xFC,0xFC,0x0C,0x0C,0x0C,0x0C,0x0C,  // -5-
	0x0C,0x0C,0x00,0x00,0x00,0x1F,0x0F,0x08,
	0x04,0x02,0x02,0x06,0x1C,0xF8,0xE0,0x00,
	0x0C,0x1E,0x3E,0x30,0x20,0x20,0x20,0x30,
	0x1C,0x0F,0x03,0x00};

unsigned char code title[]={
//Breakout
	0x04,0xFC,0xFC,0x04,0x04,0x04,0x0C,0x18,  // -B-
	0xF0,0xE0,0x00,0x00,0x00,0xFF,0xFF,0x08,
	0x08,0x08,0x1C,0x16,0x73,0xE1,0x80,0x00,
	0x20,0x3F,0x3F,0x20,0x20,0x20,0x20,0x30,
	0x1C,0x0F,0x03,0x00,
	0x04,0xFC,0xFC,0x04,0x04,0x04,0x0C,0x18,  // -R-
	0xF8,0xE0,0x00,0x00,0x00,0xFF,0xFF,0x08,
	0x38,0xF8,0xCC,0x06,0x07,0x01,0x00,0x00,
	0x20,0x3F,0x3F,0x20,0x00,0x00,0x03,0x2F,
	0x3C,0x30,0x20,0x00,
	0x04,0xFC,0xFC,0x04,0x04,0x04,0x04,0x04,  // -E-
	0x0C,0x1C,0x7C,0x00,0x00,0xFF,0xFF,0x08,
	0x08,0x08,0x1C,0x7F,0x00,0x00,0x00,0x00,
	0x20,0x3F,0x3F,0x20,0x20,0x20,0x20,0x20,
	0x30,0x38,0x3E,0x00,
	0x00,0x00,0x00,0x00,0xF0,0x0C,0x3C,0xF0,  // -A-
	0x00,0x00,0x00,0x00,0x00,0x00,0xF0,0xFF,
	0x43,0x40,0x40,0x43,0xFF,0xF0,0x00,0x00,
	0x20,0x3E,0x3F,0x20,0x00,0x00,0x00,0x00,
	0x20,0x3F,0x3E,0x20,
	0x04,0xFC,0xFC,0x04,0x00,0x80,0xE4,0x7C,  // -K-
	0x1C,0x04,0x04,0x00,0x00,0xFF,0xFF,0x78,
	0x1E,0x7F,0xE1,0x80,0x00,0x00,0x00,0x00,
	0x20,0x3F,0x3F,0x20,0x00,0x00,0x01,0x27,
	0x3E,0x38,0x20,0x20,
	0xE0,0xF0,0x18,0x0C,0x04,0x04,0x04,0x0C,  // -O-
	0x18,0xF0,0xE0,0x00,0xFF,0xFF,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,
	0x07,0x0F,0x18,0x30,0x20,0x20,0x20,0x30,
	0x18,0x0F,0x07,0x00,
	0x04,0xFC,0xFC,0x04,0x00,0x00,0x00,0x04,  // -U-
	0xFC,0xFC,0x04,0x00,0x00,0xFF,0xFF,0x00,
	0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,
	0x00,0x0F,0x1F,0x30,0x20,0x20,0x20,0x30,
	0x1F,0x0F,0x00,0x00,
	0x7C,0x1C,0x0C,0x04,0x04,0xFC,0xFC,0x04,  // -T-
	0x04,0x0C,0x1C,0x7C,0x00,0x00,0x00,0x00,
	0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x20,0x20,0x3F,0x3F,0x20,
	0x20,0x00,0x00,0x00,};
unsigned char code clone[]={
	0x00,0xFC,0x02,0x02,0x02,0x86,0x00,0x00,  // -C-
	0x01,0x01,0x01,0x00,
	0x00,0x02,0xFE,0x02,0x00,0xC0,0x00,0x01,  // -L-
	0x01,0x01,0x01,0x01,
	0x00,0xFC,0x02,0x02,0x02,0xFC,0x00,0x00,  // -O-
	0x01,0x01,0x01,0x00,
	0x02,0xFE,0x0E,0x70,0x82,0xFE,0x01,0x01,  // -N-
	0x01,0x00,0x01,0x01,
	0x02,0xFE,0x12,0x3A,0x02,0x86,0x01,0x01,  // -E-
	0x01,0x01,0x01,0x01};
unsigned char code press_start[]={
	//press_start
	0x00,0x02,0xFE,0x22,0x22,0x1C,0x00,0x01,  // -P-
	0x01,0x01,0x00,0x00,
	0x00,0x08,0xF8,0x10,0x08,0x08,0x00,0x01,  // -r-
	0x01,0x01,0x01,0x01,
	0x00,0xF0,0x28,0x28,0x28,0x30,0x00,0x00,  // -e-
	0x01,0x01,0x01,0x01,
	0x00,0x90,0x28,0x28,0x28,0xD8,0x00,0x01,  // -s-
	0x01,0x01,0x01,0x00,
	0x00,0x90,0x28,0x28,0x28,0xD8,0x00,0x01,  // -s-
	0x01,0x01,0x01,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,  // - -
	0x00,0x00,0x00,0x00,
	0x00,0x8C,0x92,0x12,0x14,0xE6,0x00,0x01,  // -S-
	0x00,0x01,0x01,0x00,
	0x00,0x06,0x02,0xFE,0x02,0x06,0x00,0x00,  // -T-
	0x01,0x01,0x01,0x00,
	0x00,0xC0,0x7A,0x46,0x78,0xC0,0x01,0x01,  // -A-
	0x01,0x00,0x01,0x01,
	0x02,0xFE,0x22,0x22,0x62,0x9C,0x01,0x01,  // -R-
	0x01,0x00,0x00,0x00,
	0x00,0x06,0x02,0xFE,0x02,0x06,0x00,0x00,  // -T-
	0x01,0x01,0x01,0x00};

unsigned char code prop[]={
//make bar longer (L): 1
0xFF,0x81,0x81,0xBF,0xBF,0xBF,0xBF,0xFF,
//clear one area (C): 2
0xFF,0xC3,0xBD,0xBD,0xBD,0xBD,0xDB,0xFF,
//Win (W): 3
0xFF,0xC1,0xBF,0xC3,0xC3,0xBF,0xC1,0xFF,
//Die (D): 4
0xFF,0x81,0x81,0xBD,0xBD,0xDB,0xE7,0xFF
};

unsigned char prop_exist=0;
bit longer=0;
unsigned char longer_time=0;
unsigned char prop_x=0;
unsigned char prop_y=0;

unsigned char prop_frame=0;

void random_prop(){
	unsigned char prop_num,x,y,i;
	bit x_change;
	if(longer){
		if(longer_time<255){
			longer_time++;
		}else{
			longer=0;
			longer_time=0;
			game_status=11;
		}
	}
	if(prop_exist==0){
		prop_num=255-TL0;
		switch(prop_num){
			case 1:
				prop_exist=1;
				y=TL0;
				x=255-y;
				y=(255-y)/5+33;
				prop_x=x;
				prop_y=y;
				y=y/8;
				for(i=0;i<8;i++){
					if(x+i<64){
						choose_screen(1);
						x_change=0;
					}else{
						x-=64;
						choose_screen(2);
						x_change=1;
					}
					lcd_write_command(0x40|(x+i));
					lcd_write_command(0xb8|y);
					lcd_write_data(prop[i]);
					if(x_change){
						x+=64;
					}
				}
				break;
			case 50:
				prop_exist=2;
				y=TL0;
				x=255-y;
				y=(255-y)/5+33;
				prop_x=x;
				prop_y=y;
				y=y/8;
				for(i=0;i<8;i++){
					if(x+i<64){
						choose_screen(1);
						x_change=0;
					}else{
						x-=64;
						choose_screen(2);
						x_change=1;
					}
					lcd_write_command(0x40|(x+i));
					lcd_write_command(0xb8|y);
					lcd_write_data(prop[i+8]);
					if(x_change){
						x+=64;
					}
				}
				break;
			case 100:
				prop_exist=3;
				y=TL0;
				x=255-y;
				y=(255-y)/5+33;
				prop_x=x;
				prop_y=y;
				y=y/8;
				for(i=0;i<8;i++){
					if(x+i<64){
						choose_screen(1);
						x_change=0;
					}else{
						x-=64;
						choose_screen(2);
						x_change=1;
					}
					lcd_write_command(0x40|(x+i));
					lcd_write_command(0xb8|y);
					lcd_write_data(prop[i+16]);
					if(x_change){
						x+=64;
					}
				}
				break;
			case 20:
				prop_exist=4;
				y=TL0;
				x=255-y;
				y=(255-y)/5+33;
				prop_x=x;
				prop_y=y;
				y=y/8;
				for(i=0;i<8;i++){
					if(x+i<64){
						choose_screen(1);
						x_change=0;
					}else{
						x-=64;
						choose_screen(2);
						x_change=1;
					}
					lcd_write_command(0x40|(x+i));
					lcd_write_command(0xb8|y);
					lcd_write_data(prop[i+24]);
					if(x_change){
						x+=64;
					}
				}
				break;
			default:break;
		}
	}else{
		if(prop_frame>100){
			x=prop_x;
			y=prop_y;
			y=y/8;
			for(i=0;i<8;i++){
					if(x+i<64){
						choose_screen(1);
						x_change=0;
					}else{
						x-=64;
						choose_screen(2);
						x_change=1;
					}
					lcd_write_command(0x40|(x+i));
					lcd_write_command(0xb8|y);
					lcd_write_data(0x00);
					if(x_change){
						x+=64;
					}
			}
			prop_frame=0;
			prop_exist=0;
		}else{
			prop_frame++;
		}
	}
}

void clear_low_screen(){
	unsigned char x,y;
	choose_screen(0);
	for(x=4;x<8;x++){
		for(y=0;y<64;y++){
			lcd_write_command(0xb8|x);
			lcd_write_command(0x40|y);
			lcd_write_data(0x00);
		}
	}
}
void show_life(unsigned char life){
	unsigned char x,y,i;
	bit flag;
	clear_low_screen();
		for(i=0;i<6;i++){
			for(y=0;y<12;y++){
				for(x=0;x<3;x++){
					flag=0;
					y+=20+15*i;
					x+=4;
					if(y<64){
						choose_screen(1);
					}else{
						choose_screen(2);
						y-=64;
						flag=1;
					}
					lcd_write_command(0xb8|x);
					lcd_write_command(0x40|y);
					if(flag){
						y+=64;
					}
					y-=20+15*i;
					x-=4;
					if(i<5){
						lcd_write_data(lifefont[y+x*12+i*36]);
					}else{
						lcd_write_data(number[y+12*x+life*36]);
					}
				}	
			}
		}	
}
void show_level(unsigned char level){
	unsigned char x,y,i;
	bit flag;
	clear_low_screen();
		for(i=0;i<7;i++){
			for(y=0;y<12;y++){
				for(x=0;x<3;x++){
					flag=0;
					y+=20+15*i;
					x+=4;
					if(y<64){
						choose_screen(1);
					}else{
						choose_screen(2);
						y-=64;
						flag=1;
					}
					lcd_write_command(0xb8|x);
					lcd_write_command(0x40|y);
					if(flag){
						y+=64;
					}
					y-=20+15*i;
					x-=4;
					if(i<6){
						lcd_write_data(levelfont[y+x*12+i*36]);
					}else{
						lcd_write_data(number[y+12*x+level*36]);
					}
				}	
			}
		}	
}


//variables of block
//block1 for level 1
/*   for test of win 
unsigned char code block1[]={
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};
*/
///*
unsigned char code block1[]={
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xF7,0xEF,0xEF,0xDF,0xDF,0xBF,0x7F,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0x7F,0x9F,0xE7,0xFB,0xFD,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x01,0xFD,0xFD,
0x0D,0xED,0xED,0xED,0xED,0xED,0x6D,0x6D,0x2C,0x2D,0xED,0xED,0xED,0xED,0xED,0xED,
0xED,0xED,0x2D,0x2C,0x6D,0x6D,0x6D,0xED,0xED,0xED,0xED,0xED,0x0D,0xFD,0xFD,0x01,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0xFF,0xFF,
0x80,0xBF,0xBF,0xBF,0xBC,0xBC,0xBE,0xBE,0xB3,0xAD,0xAF,0xB7,0xBB,0xB9,0xB7,0xAF,
0xAF,0xB5,0xBB,0xBF,0xBE,0xBE,0xBE,0xBF,0xBF,0xBF,0xBF,0xBF,0x80,0xFF,0xFF,0x00,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFC,0xFD,0xFD,
0xFD,0xFD,0xCD,0xC1,0xF1,0xFD,0xFD,0xFD,0xFD,0xFD,0xFD,0xFD,0xFD,0xFD,0xFD,0xFD,
0xFD,0xFD,0xFD,0xFD,0xF1,0xC1,0xCD,0xFD,0xFD,0xFD,0xFD,0xFD,0xFD,0xFD,0xFD,0xFC,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF
};
//*/
//block2 for level 2
/*   for test of win 
unsigned char code block2[]={
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};
*/
///*
unsigned char code block2[]={
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x7F,0xBF,0xBF,0x7F,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0x7F,0xBF,0xBF,0x7F,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0x07,0x03,0x01,0x01,0x01,0x01,0x03,0x07,0x01,0x06,0x03,0x01,0x01,0x01,0x01,
0x03,0x07,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x07,0x03,0x01,0x01,0x01,0x01,0x03,
0x07,0x01,0x06,0x03,0x01,0x01,0x71,0xF9,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xF0,0xE0,0xC0,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0xC0,
0xE0,0xF0,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF0,0xE0,0xC0,0x80,0x80,0x80,0x80,
0x80,0x80,0x80,0x80,0x80,0x80,0x80,0xC0,0xE0,0xF0,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF
};
//*/
//block3 for level 3
/*   for test of win 
unsigned char code block3[]={
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};
*/
///*
unsigned char code block3[]={
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x7F,0x7F,0x7F,0x7F,0x7F,0x7F,
0x7F,0x7F,0x7F,0x7F,0x7F,0x7F,0x7F,0x7F,0x7F,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xBF,0x1F,
0x4F,0xE7,0xF3,0xFB,0xF9,0xFD,0xFD,0xFC,0xFE,0xBE,0x1E,0x0F,0x07,0x03,0x01,0x01,
0x40,0xE0,0xF0,0xE0,0x41,0x01,0x03,0x07,0x0E,0x1E,0xBE,0xFC,0xFD,0xFD,0xF9,0xFB,
0xF3,0xE7,0x4F,0x1F,0xBF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFE,0xFC,0xF9,0xFB,0xF3,0xF7,0xF7,0xE7,0xEF,0xEF,0xCF,0xDE,0xDC,0xD8,0xD0,0xD0,
0xC0,0xC0,0xC1,0xC0,0xD0,0xD0,0xD8,0xDC,0xCE,0xEF,0xEF,0xE7,0xF7,0xF7,0xF3,0xFB,
0xF9,0xFC,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF
};
//*/


//functions of block
//draw block at the begining
void draw_block(){
	unsigned char x,y;
	choose_screen(0);
	for(x=0;x<4;x++){
		for(y=0;y<64;y++){
			lcd_write_command(0xb8|x);
			lcd_write_command(0x40|y);
			switch(level){
				case 1: lcd_write_data(block1[x*64+y]);break;
				case 2: lcd_write_data(block2[x*64+y]);break;
				case 3: lcd_write_data(block3[x*64+y]);break;
				default: lcd_write_data(block1[x*64+y]);break;
			}
		}	
	}
}
//check block
void check_block(){
	unsigned char i,x,y,rdata;
	unsigned char now_game_status=game_status;
	game_status=2;
	for(i=1;i<3;i++){
		choose_screen(i);
		for(x=0;x<4;x++){
			for(y=0;y<64;y++){
				lcd_write_command(0xb8|x);
				lcd_write_command(0x40|y);
				rdata=lcd_read_data();
				if(rdata!=0x00){
					game_status=now_game_status;
					break;
				}
			}
			if(game_status==now_game_status){
				break;
			}
		}
		if(game_status==now_game_status){
			break;
		}
	}
}

//variables of bar
//location of the most left point of bar
unsigned char code o_bar_sit[]={0,63};
unsigned char bar_sit[2];//(x,y)
unsigned char temp_bar_sit_x;
//bar speed
unsigned char o_bar_speed;
unsigned char bar_speed;
//bar length
unsigned char o_bar_len;
unsigned char bar_len;
//bar direction
bit o_bar_direction=1;
bit bar_direction;//0:left, 1:right

//functions for bar
//init bar
void init_bar(){
	unsigned char i;
	switch(level){
		case 1: o_bar_speed=1;o_bar_len=24;break;
		case 2: o_bar_speed=2;o_bar_len=20;break;
		case 3: o_bar_speed=3;o_bar_len=12;break;
		default:o_bar_speed=1;o_bar_len=24;break;
	}
	bar_sit[0]=o_bar_sit[0];
	bar_sit[1]=o_bar_sit[1];
	bar_speed=o_bar_speed;
	bar_len=o_bar_len;
	bar_direction=o_bar_direction;
	for(i=0;i<bar_len;i++){
		set_dot(bar_sit[0]+i,bar_sit[1]);
	}
}
//draw bar
void draw_bar(){
	unsigned char i;
	if(bar_direction){
		//go right
		if(bar_sit[0]<=128-bar_len-bar_speed && bar_len+bar_speed<=128){
			for(i=1;i<bar_speed+1;i++){
				//clear preivous bar
				clear_dot(bar_sit[0]+i-1,bar_sit[1]);
				//draw new bar
				set_dot(bar_sit[0]+bar_len-1+i,bar_sit[1]);
			}
			//recalculate bar location
			bar_sit[0]+=bar_speed;
		}
	}else{
		//go left
		if(bar_sit[0]>=0+bar_speed){
			for(i=1;i<bar_speed+1;i++){
				//clear preivous bar
				clear_dot(bar_sit[0]+bar_len-i,bar_sit[1]);
				//draw new bar
				set_dot(bar_sit[0]-i,bar_sit[1]);
			}
			//recalculate bar location
			bar_sit[0]-=bar_speed;
		}
	}
}

//variables of ball
//location of ball
unsigned char code o_ball_sit[]={7,62};//(x,y)
unsigned char ball_sit[2];//(x,y)
//ball speed
unsigned char code o_ball_speed[]={0,1};
unsigned char ball_speed[2];//(x,y)
//ball direction
bit o_ball_direction_x=0;
bit ball_direction_x;//x: 0->left, 1->right.
bit o_ball_direction_y=0;  
bit ball_direction_y;//y: 0->down, 1->up.

//functions for ball
//init ball
void init_ball(){
	ball_sit[0]=o_ball_sit[0];
	ball_sit[1]=o_ball_sit[1];
	ball_speed[0]=o_ball_speed[0];
	ball_speed[1]=o_ball_speed[1];
	ball_direction_x=o_ball_direction_x;
	ball_direction_y=o_ball_direction_y;
	set_dot(ball_sit[0],ball_sit[1]);
	set_dot(ball_sit[0],ball_sit[1]-1);
	set_dot(ball_sit[0]+1,ball_sit[1]);
	set_dot(ball_sit[0]+1,ball_sit[1]-1);	
}
//clear preview ball
void clear_ball(){
	clear_dot(ball_sit[0],ball_sit[1]);
	clear_dot(ball_sit[0]+1,ball_sit[1]);
	clear_dot(ball_sit[0],ball_sit[1]-1);
	clear_dot(ball_sit[0]+1,ball_sit[1]-1);
}
//calculate now ball
void move_ball(){
	bit next_dot_y,next_dot_x;
	unsigned char i;
	bit x_change;
	//check whether the direction should be changed
	LS1=change;
	if(ball_direction_y){
		if(read_dot(ball_sit[0],ball_sit[1]-2) || read_dot(ball_sit[0]+1,ball_sit[1]-2) || (ball_sit[1]-1)==0){
			if(ball_sit[1]>34 && ball_sit[1]<62 && ball_sit[0]<126 && ball_sit[0]>0){
				prop_y=prop_y/8;
				for(i=0;i<8;i++){
						if(prop_x+i<64){
							choose_screen(1);
							x_change=0;
						}else{
							prop_x-=64;
							choose_screen(2);
							x_change=1;
						}
						lcd_write_command(0x40|(prop_x+i));
						lcd_write_command(0xb8|prop_y);
						lcd_write_data(0x00);
						if(x_change){
							prop_x+=64;
						}
				}
				prop_y=prop_y*8;
				prop_frame=0;
				switch(prop_exist){
					case 1:longer=1;game_status=7;break;
					case 2:game_status=8;break;
					case 3:game_status=9;break;
					case 4:game_status=10;break;
					default:break;
				}
				prop_exist=0;
			}else{
				LS1=do_1;
				if((ball_sit[1]-1)!=0){
					clear_dot(ball_sit[0],ball_sit[1]-2);
					clear_dot(ball_sit[0]+1,ball_sit[1]-2);
					if((ball_sit[1]-2)!=0){
						clear_dot(ball_sit[0],ball_sit[1]-3);
						clear_dot(ball_sit[0]+1,ball_sit[1]-3);
					}
				}
				ball_direction_y=~ball_direction_y;
			}	
		}
	}else{
		if(read_dot(ball_sit[0],ball_sit[1]+1) || read_dot(ball_sit[0]+1,ball_sit[1]+1)){
			if(ball_sit[1]!=63){
				if(ball_sit[1]>34 && ball_sit[1]<62 && ball_sit[0]<126 && ball_sit[0]>0){
					prop_y=prop_y/8;
					for(i=0;i<8;i++){
							if(prop_x+i<64){
								choose_screen(1);
								x_change=0;
							}else{
								prop_x-=64;
								choose_screen(2);
								x_change=1;
							}
							lcd_write_command(0x40|(prop_x+i));
							lcd_write_command(0xb8|prop_y);
							lcd_write_data(0x00);
							if(x_change){
								prop_x+=64;
							}
					}
					prop_y=prop_y*8;
					prop_frame=0;
					switch(prop_exist){
						case 1:longer=1;game_status=7;break;
						case 2:game_status=8;break;
						case 3:game_status=9;break;
						case 4:game_status=10;break;
						default:break;
					}
					prop_exist=0;
				}else{
					LS1=do_1;
					if(ball_sit[1]+1!=bar_sit[1]){
						clear_dot(ball_sit[0],ball_sit[1]+1);
						clear_dot(ball_sit[0]+1,ball_sit[1]+1);
						clear_dot(ball_sit[0],ball_sit[1]+2);
						clear_dot(ball_sit[0]+1,ball_sit[1]+2);
					}else{
						LS1=do_2;
						ball_speed[0]=bar_speed;
						ball_direction_x=bar_direction;
					}
					ball_direction_y=~ball_direction_y;
				}
			}else{
				game_status=0;
			}
		}
	}
	if(game_status==1){
	if(ball_direction_x){
		if(read_dot(ball_sit[0]+2,ball_sit[1]) || read_dot(ball_sit[0]+2,ball_sit[1]-1) || (ball_sit[0]+1)==127){
			if(ball_sit[1]>34 && ball_sit[1]<62 && ball_sit[0]<126 && ball_sit[0]>0){
				prop_y=prop_y/8;
				for(i=0;i<8;i++){
						if(prop_x+i<64){
							choose_screen(1);
							x_change=0;
						}else{
							prop_x-=64;
							choose_screen(2);
							x_change=1;
						}
						lcd_write_command(0x40|(prop_x+i));
						lcd_write_command(0xb8|prop_y);
						lcd_write_data(0x00);
						if(x_change){
							prop_x+=64;
						}
				}
				prop_y=prop_y*8;
				prop_frame=0;
				switch(prop_exist){
					case 1:longer=1;game_status=7;break;
					case 2:game_status=8;break;
					case 3:game_status=9;break;
					case 4:game_status=10;break;
					default:break;
				}
				prop_exist=0;
			}else{
				LS1=do_1;
				clear_dot(ball_sit[0]+2,ball_sit[1]);
				clear_dot(ball_sit[0]+2,ball_sit[1]-1);
				clear_dot(ball_sit[0]+3,ball_sit[1]);
				clear_dot(ball_sit[0]+3,ball_sit[1]-1);
				ball_direction_x=~ball_direction_x;
			}
		}
	}else{
		if(read_dot(ball_sit[0]-1,ball_sit[1]) || read_dot(ball_sit[0]-1,ball_sit[1]-1) || ball_sit[0]==0){
			if(ball_sit[1]>34 && ball_sit[1]<62 && ball_sit[0]<126 && ball_sit[0]>0){
				prop_y=prop_y/8;
				for(i=0;i<8;i++){
						if(prop_x+i<64){
							choose_screen(1);
							x_change=0;
						}else{
							prop_x-=64;
							choose_screen(2);
							x_change=1;
						}
						lcd_write_command(0x40|(prop_x+i));
						lcd_write_command(0xb8|prop_y);
						lcd_write_data(0x00);
						if(x_change){
							prop_x+=64;
						}
				}
				prop_y=prop_y*8;
				prop_frame=0;
				switch(prop_exist){
					case 1:longer=1;game_status=7;break;
					case 2:game_status=8;break;
					case 3:game_status=9;break;
					case 4:game_status=10;break;
					default:break;
				}
				prop_exist=0;
			}else{
				LS1=do_1;
				if(ball_sit[0]!=0){
					clear_dot(ball_sit[0]-1,ball_sit[1]);
					clear_dot(ball_sit[0]-1,ball_sit[1]-1);
					if((ball_sit[0]-1)!=0){
						clear_dot(ball_sit[0]-2,ball_sit[1]);
						clear_dot(ball_sit[0]-2,ball_sit[1]-1);
					}
				}
				ball_direction_x=~ball_direction_x;
			}
		}
	}
	//according to y direction to check next y dot status
	next_dot_y=0;
	if(ball_direction_y){
		//go up
		for(i=1;i<1+ball_speed[1];i++){//check if there a dot in speed range
			if(ball_sit[1]-1-i==0){
				next_dot_y=1;
				ball_sit[1]-=i;
				break;
			}else if(read_dot(ball_sit[0],ball_sit[1]-1-i) || read_dot(ball_sit[0]+1,ball_sit[1]-1-i)){//if there is a dot
				next_dot_y=1;
				ball_sit[1]-=(i-1);
				break;
			}
		}
		if(~next_dot_y){
			ball_sit[1]-=ball_speed[1];
		}
	}else{
		//go down
		for(i=1;i<1+ball_speed[1];i++){//check if there a dot in speed range
			if(read_dot(ball_sit[0],ball_sit[1]+i) || read_dot(ball_sit[0]+1,ball_sit[1]+i)){//if there is a dot
				next_dot_y=1;
				ball_sit[1]+=(i-1);
				break;
			}
		}
		if(~next_dot_y){
			ball_sit[1]+=ball_speed[1];
		}
	}
	//according to x direction to check next x dot status
	next_dot_x=0;
	if(ball_direction_x){
		//go right
		for(i=1;i<1+ball_speed[1];i++){//check if there a dot in speed range
			if(ball_sit[0]+1+i==127){
				next_dot_x=1;
				ball_sit[0]+=i;
				break;
			}else if(read_dot(ball_sit[0]+1+i,ball_sit[1]) || read_dot(ball_sit[0]+1+i,ball_sit[1]-1)){//if there is a dot
				next_dot_x=1;
				ball_sit[0]+=(i-1);
				break;
			}
		}
		if(~next_dot_x){
			ball_sit[0]+=ball_speed[0];
		}
	}else{
		//go left
		for(i=1;i<1+ball_speed[1];i++){//check if there a dot in speed range
			if(ball_sit[0]-i==0){
				next_dot_x=1;
				ball_sit[0]-=i;
				break;
			}else if(read_dot(ball_sit[0]-i,ball_sit[1]) || read_dot(ball_sit[0]-i,ball_sit[1]-1)){//if there is a dot
				next_dot_x=1;
				ball_sit[0]-=(i-1);
				break;
			}
		}
		if(~next_dot_x){
			ball_sit[0]-=ball_speed[0];
		}
	}
	}

}
//draw now ball
void draw_ball(){
	//clear previous ball
	clear_ball();
	//calculate now ball
	move_ball();
	//draw now ball
	set_dot(ball_sit[0],ball_sit[1]);
	set_dot(ball_sit[0],ball_sit[1]-1);
	set_dot(ball_sit[0]+1,ball_sit[1]);
	set_dot(ball_sit[0]+1,ball_sit[1]-1);
}

//refresh screen
void refresh_screen(){
	bit flag,x_change;
	unsigned char i;
	unsigned char x,y;
	//Add frame number
	if(game_status!=1){
		number_frame++;
	}
	if(game_status==4){
		//start music
		LS1=title_music;
		//show title
		if(frame_begin==0){
			number_frame=0;
			frame_begin=1;
		}else{
			if(frame_finish==0){
				//main program for show title
				//show BREAKOUT
				if(number_frame<80){
					for(i=number_frame/10;i<number_frame/10+1;i++){
						for(y=0;y<12;y++){
							for(x=0;x<3;x++){
								flag=0;
								y+=5+15*i;
								x+=1;
								if(y<64){
									choose_screen(1);
								}else{
									choose_screen(2);
									y-=64;
									flag=1;
								}
								lcd_write_command(0xb8|x);
								lcd_write_command(0x40|y);
								if(flag){
									y+=64;
								}
								y-=5+15*i;
								x-=1;
								lcd_write_data(title[y+x*12+i*36]);
							}	
						}
					}
				}else if(number_frame>80 && number_frame<120){
					//show "clone"
					//clear previous fonts
					choose_screen(0);
					for(x=4;x<6;x++){
						for(y=64-(number_frame-80);y<64;y++){
							lcd_write_command(0xb8|x);
							lcd_write_command(0x40|y);
							lcd_write_data(0x00);
						}
					}
					//show next fonts
					for(i=0;i<5;i++){
						for(y=0;y<6;y++){
							for(x=0;x<2;x++){
								flag=0;
								y+=127-(number_frame-80)+7*i;
								x+=4;
								if(y<64){
									choose_screen(1);
								}else{
									choose_screen(2);
									y-=64;
									flag=1;
								}
								if(y<64){
									lcd_write_command(0xb8|x);
									lcd_write_command(0x40|y);
									if(flag){
										y+=64;
									}
								y-=127-(number_frame-80)+7*i;
								x-=4;
								lcd_write_data(clone[y+x*6+i*12]);
								}
							}	
						}
					}
				}else if(number_frame>120){
					frame_finish=1;	
				}
			}else{
				game_status=5;
				frame_finish=0;
				frame_begin=0;
			}
		}
	}else if(game_status==5){
		if(frame_begin==0){
		//prepare for flashing
			frame_begin=1;
			number_frame=0;
		}else{
			//check button
			start=1;
			if(start==0){
				LS1=change;
				first_page();
				draw_block();
				game_status=6;
				frame_begin=0;
			}else{
			//flashing
			if(number_frame>20){
				number_frame=0;
			}else if(number_frame>10 && number_frame<20){
				choose_screen(1);
				for(x=6;x<8;x++){
					for(y=20;y<64;y++){
						lcd_write_command(0xb8|x);
						lcd_write_command(0x40|y);
						lcd_write_data(0x00);
					}
				}
				choose_screen(2);
				for(x=6;x<8;x++){
					for(y=0;y<43;y++){
						lcd_write_command(0xb8|x);
						lcd_write_command(0x40|y);
						lcd_write_data(0x00);
					}
				}
			}else if(number_frame<30){
				for(i=0;i<11;i++){
					for(y=0;y<6;y++){
						for(x=0;x<2;x++){
							flag=0;
							y+=20+7*i;
							x+=6;
							if(y<64){
								choose_screen(1);
							}else{
								choose_screen(2);
								y-=64;
								flag=1;
							}
							if(y<64){
							lcd_write_command(0xb8|x);
							lcd_write_command(0x40|y);
							if(flag){
								y+=64;
							}
							y-=20+7*i;
							x-=6;
							lcd_write_data(press_start[y+x*6+i*12]);
							}
						}	
					}
				}
			}
			}
		}
	}else if(game_status==6){
		//start music
		LS1=level_music;
		//show level
		//show life
		if(frame_finish==0){
			number_frame=0;
		}
		max_number_frame=30;
		if(number_frame<max_number_frame){
			if(frame_finish==0){
				show_level(level);
				frame_finish=1;
			}
		}else{
			clear_low_screen();
			game_status=3;
			frame_finish=0;
		}
	}else if(game_status==3){
		//show life
		if(frame_finish==0){
			number_frame=0;
		}
		max_number_frame=30;
		if(number_frame<max_number_frame){
			if(frame_finish==0){
				show_life(life);
				frame_finish=1;
			}
		}else{
			TR0=1;
			LS1=change;
			clear_low_screen();
			init_ball();
			init_bar();
			game_status=1;
			frame_finish=0;
		}
	}else if(game_status==7){
		//become longer
		if(frame_begin==0){
			frame_begin=1;
			number_frame=0;
		}else{
			if(number_frame<50){
				if(number_frame%10==0){
					for(i=0;i<bar_len;i++){
						clear_dot(i+bar_sit[0],bar_sit[1]);
					}
				}else{
					for(i=0;i<bar_len;i++){
						set_dot(i+bar_sit[0],bar_sit[1]);
					}
				}
			}else if(number_frame==50){
				bar_len=128;
				temp_bar_sit_x=bar_sit[0];
				bar_sit[0]=0;
			}else if(number_frame<100){
				if(number_frame%10==0){
					for(i=0;i<bar_len;i++){
						clear_dot(i+bar_sit[0],bar_sit[1]);
					}
				}else{
					for(i=0;i<bar_len;i++){
						set_dot(i+bar_sit[0],bar_sit[1]);
					}
				}
			}else{
				for(i=0;i<bar_len;i++){
					set_dot(i+bar_sit[0],bar_sit[1]);
				}
				frame_begin=0;
				game_status=1;
				longer_time=0;
				longer=1;
			}
		}
	}else if(game_status==8){
		//clear area
		if((255-TL0)<85){
			x=0;
		}else{
			x=2;
		}
		if(frame_begin==0){
			frame_begin=1;
			number_frame=0;
		}else{
			if(number_frame<50){
				if(number_frame%10==0){
					for(i=0;i<2;i++){
						for(y=0;y<64;y++){
							choose_screen(0);
							lcd_write_command(0xb8|x+i);
							lcd_write_command(0x40|y);
							lcd_write_data(0x00);
						}
					}
				}else{
					for(i=0;i<2;i++){
						for(y=0;y<64;y++){
							choose_screen(0);
							lcd_write_command(0xb8|x+i);
							lcd_write_command(0x40|y);
							lcd_write_data(0xFF);
						}
					}
				}
			}else{
				for(i=0;i<2;i++){
						for(y=0;y<64;y++){
							choose_screen(0);
							lcd_write_command(0xb8|x+i);
							lcd_write_command(0x40|y);
							lcd_write_data(0x00);
						}
				}
				frame_begin=0;
				game_status=1;
			}
		}
	}else if(game_status==9){
		//win
		x=prop_x;
		y=prop_y;
		y=y/8;
		if(frame_begin==0){
			frame_begin=1;
			number_frame=0;
		}else{
			if(number_frame<50){
				if(number_frame%10==0){
					for(i=0;i<8;i++){
						if(x+i<64){
							choose_screen(1);
							x_change=0;
						}else{
							x-=64;
							choose_screen(2);
							x_change=1;
						}
						lcd_write_command(0x40|(x+i));
						lcd_write_command(0xb8|y);
						lcd_write_data(prop[0x00]);
						if(x_change){
							x+=64;
						}
					}
				}else{
					for(i=0;i<8;i++){
						if(x+i<64){
							choose_screen(1);
							x_change=0;
						}else{
							x-=64;
							choose_screen(2);
							x_change=1;
						}
						lcd_write_command(0x40|(x+i));
						lcd_write_command(0xb8|y);
						lcd_write_data(prop[i+16]);
						if(x_change){
							x+=64;
						}		
					}
				}
			}else{
				for(i=0;i<8;i++){
					if(x+i<64){
						choose_screen(1);
						x_change=0;
					}else{
						x-=64;
						choose_screen(2);
						x_change=1;
					}
					lcd_write_command(0x40|(x+i));
					lcd_write_command(0xb8|y);
					lcd_write_data(0x00);
					if(x_change){
						x+=64;
					}
				}
				frame_begin=0;
				game_status=2;
			}
		}
	}else if(game_status==10){
		//Die
		x=prop_x;
		y=prop_y;
		y=y/8;
		if(frame_begin==0){
			frame_begin=1;
			number_frame=0;
		}else{
			if(number_frame<50){
				if(number_frame%10==0){
					for(i=0;i<8;i++){
						if(x+i<64){
							choose_screen(1);
							x_change=0;
						}else{
							x-=64;
							choose_screen(2);
							x_change=1;
						}
						lcd_write_command(0x40|(x+i));
						lcd_write_command(0xb8|y);
						lcd_write_data(prop[0x00]);
						if(x_change){
							x+=64;
						}
					}
				}else{
					for(i=0;i<8;i++){
						if(x+i<64){
							choose_screen(1);
							x_change=0;
						}else{
							x-=64;
							choose_screen(2);
							x_change=1;
						}
						lcd_write_command(0x40|(x+i));
						lcd_write_command(0xb8|y);
						lcd_write_data(prop[i+24]);
						if(x_change){
							x+=64;
						}		
					}
				}
			}else{
				for(i=0;i<8;i++){
					if(x+i<64){
						choose_screen(1);
						x_change=0;
					}else{
						x-=64;
						choose_screen(2);
						x_change=1;
					}
					lcd_write_command(0x40|(x+i));
					lcd_write_command(0xb8|y);
					lcd_write_data(0x00);
					if(x_change){
						x+=64;
					}
				}
				frame_begin=0;
				game_status=0;
			}
		}
	}else if(game_status==11){
		//end longer
		if(frame_begin==0){
			frame_begin=1;
			number_frame=0;
			longer=0;
		}else{
			if(number_frame<50){
				if(number_frame%10==0){
					for(i=0;i<bar_len;i++){
						clear_dot(i+bar_sit[0],bar_sit[1]);
					}
				}else{
					for(i=0;i<bar_len;i++){
						set_dot(i+bar_sit[0],bar_sit[1]);
					}
				}
			}else if(number_frame==50){
				for(i=0;i<bar_len;i++){
					clear_dot(i+bar_sit[0],bar_sit[1]);
				}
				bar_len=o_bar_len;
				bar_sit[0]=temp_bar_sit_x;
			}else if(number_frame<100){
				if(number_frame%10==0){
					for(i=0;i<bar_len;i++){
						clear_dot(i+bar_sit[0],bar_sit[1]);
					}
				}else{
					for(i=0;i<bar_len;i++){
						set_dot(i+bar_sit[0],bar_sit[1]);
					}
				}
			}else{
				for(i=0;i<bar_len;i++){
					set_dot(i+bar_sit[0],bar_sit[1]);
				}
				frame_begin=0;
				game_status=1;
			}
		}
	}else{
	//check block
	check_block();
	//draw bar
	if(game_status==1){
		//music
		LS1=run_music;
		//continuous status
		random_prop();
		draw_bar();
		draw_ball();
	}else if(game_status==0){
		LS1=die_music;
		//end status
		if(life==0){
			//init level
			level=1;
			life=5;
			//die information
			 //show life
			if(frame_finish==0){
				number_frame=0;
			}
			if(number_frame<30){
				if(frame_finish==0){
					show_life(life);
					frame_finish=1;
				}
			}else if(number_frame==30){
				//show "DIE!"
				first_page();
				for(i=0;i<4;i++){
					for(y=0;y<12;y++){
						for(x=0;x<3;x++){
							flag=0;
							y+=30+20*i;
							x+=1;
							if(y<64){
								choose_screen(1);
							}else{
								choose_screen(2);
								y-=64;
								flag=1;
							}
							lcd_write_command(0xb8|x);
							lcd_write_command(0x40|y);
							if(flag){
								y+=64;
							}
							y-=30+20*i;
							x-=1;
							lcd_write_data(die[y+x*12+i*36]);
						}	
					}	
				}
			}else if(number_frame>30){
				//check button
				start=1;
				if(start==0){
					first_page();
					game_status=4;
					frame_finish=0;
				}else{
				//flashing
					if(number_frame>50){
						number_frame=31;
					}else if(number_frame>40 && number_frame<50){
						choose_screen(0);
						for(x=6;x<8;x++){
							for(y=0;y<64;y++){
								lcd_write_command(0xb8|x);
								lcd_write_command(0x40|y);
								lcd_write_data(0x00);
							}
						}
					}else if(number_frame<40){
						for(i=0;i<11;i++){
							for(y=0;y<6;y++){
								for(x=0;x<2;x++){
									flag=0;
									y+=20+7*i;
									x+=6;
									if(y<64){
										choose_screen(1);
									}else{
										choose_screen(2);
										y-=64;
										flag=1;
									}
									if(y<64){
										lcd_write_command(0xb8|x);
										lcd_write_command(0x40|y);
									if(flag){
										y+=64;
									}
									y-=20+7*i;
									x-=6;
									lcd_write_data(press_start[y+x*6+i*12]);
									}
								}	
							}
						}
					}
				}
			}
		}else{
			//show life
			if(frame_finish==0){
				number_frame=0;
				life-=1;
			}
			max_number_frame=30;
			if(number_frame<max_number_frame){
				if(frame_finish==0){
					show_life(life);
					frame_finish=1;
				}
			}else{
				clear_low_screen();
				init_ball();
				init_bar();
				game_status=1;
				frame_finish=0;
			}
		}
	}else if(game_status==2){
		//win status
		//"WIN!"
		LS1=win_music;
		if(frame_finish==0){
			frame_finish=1;
			number_frame=0;
			first_page();
			for(i=0;i<4;i++){
				for(y=0;y<12;y++){
					for(x=0;x<3;x++){
						flag=0;
						y+=30+20*i;
						x+=1;
						if(y<64){
							choose_screen(1);
						}else{
							choose_screen(2);
							y-=64;
							flag=1;
						}
						lcd_write_command(0xb8|x);
						lcd_write_command(0x40|y);
						if(flag){
							y+=64;
						}
						y-=30+20*i;
						x-=1;
						lcd_write_data(win[y+x*12+i*36]);
					}	
				}
			}
		}else{
			//check button
			start=1;
			if(start==0){
				first_page();
				if(level<3){
					level++;
					draw_block();
					game_status=6;
					
				}else{
					level=1;
					life=5;
					game_status=4;
				}
				frame_finish=0;
			}else{
			//flashing
			if(number_frame>20){
				number_frame=0;
			}else if(number_frame>10 && number_frame<20){
				choose_screen(0);
				for(x=6;x<8;x++){
					for(y=0;y<64;y++){
						lcd_write_command(0xb8|x);
						lcd_write_command(0x40|y);
						lcd_write_data(0x00);
					}
				}
			}else if(number_frame<30){
				for(i=0;i<11;i++){
					for(y=0;y<6;y++){
						for(x=0;x<2;x++){
							flag=0;
							y+=20+7*i;
							x+=6;
							if(y<64){
								choose_screen(1);
							}else{
								choose_screen(2);
								y-=64;
								flag=1;
							}
							if(y<64){
							lcd_write_command(0xb8|x);
							lcd_write_command(0x40|y);
							if(flag){
								y+=64;
							}
							y-=20+7*i;
							x-=6;
							lcd_write_data(press_start[y+x*6+i*12]);
							}
						}	
					}
				}
			}
			}	
		}
	}
	}
}

//initial fiunction
//init the game
void game_init(){
	lcd_init();
	first_page();
}